"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("react-device-detect"),n=require("hammerjs");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=r(e),i=r(n),l=function(e,t){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},l(e,t)};var s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},s.apply(this,arguments)};function a(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function c(e,t,n,r){return new(n||(n=Promise))((function(o,i){function l(e){try{a(r.next(e))}catch(e){i(e)}}function s(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var f={transition:"opacity 0.3s"},d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.highlighted=0,t.circles=[6,20,34],t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.circles.length;this.intervalId=setInterval((function(){var n=e.highlighted+1;e.highlighted=n>=t?0:n,e.forceUpdate()}),300)},t.prototype.shouldComponentUpdate=function(){return!1},t.prototype.componentWillUnmount=function(){clearInterval(this.intervalId)},t.prototype.render=function(){var e=this,t=e.props.color,n=e.highlighted,r=e.circles;return o.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40",width:"32px",height:"32px"},r.map((function(e,r){return o.default.createElement("circle",{key:r,cx:e,cy:"20",r:"3",fill:t,opacity:n===r?1:.2,style:f})})))},t}(e.Component);function h(e){var t=e.color,n=a(e,["color"]);return o.default.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40",width:"32px",height:"32px"},n),o.default.createElement("line",{x1:"20",y1:"4",x2:"20",y2:"32",strokeLinecap:"round",strokeWidth:3,stroke:t}),o.default.createElement("polyline",{points:"10 24 20 34 30 24",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,fill:"none",stroke:t}))}var p=function(n){var r=n.children;n.className;var l=n.disabled,f=n.distanceToRefresh,p=void 0===f?30:f,v=n.style,y=n.onRefresh,m=n.onScrollEnd,g=a(n,["children","className","disabled","distanceToRefresh","style","onRefresh","onScrollEnd"]),b=e.useState(!1),w=b[0],x=b[1],E=0,k=e.useCallback((function(){return new Promise((function(e,t){y(e,t)}))}),[]);function O(e){E=e}function L(e,t){0===document.scrollingElement.scrollTop&&0===t.scrollTop&&e>E&&(e-E<p&&(t.style.transform=t.style.webkitTransform="translate3d( 0, "+e+"px, 0 )"),t.classList.contains("refreshing")||function(e){c(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){switch(r.label){case 0:return t=function(e){return new Promise((function(t){return setTimeout(t,e)}))},x(!0),k(),n=document.querySelector(".refresher"),e.classList.add("refreshing"),n.classList.add("refreshing"),[4,t(500)];case 1:return r.sent(),x(!1),n.classList.add("rotate"),[4,t(500)];case 2:return r.sent(),e.style.transform=e.style.webkitTransform="",n.classList.add("shrink"),[4,t(500)];case 3:return r.sent(),e.classList.remove("refreshing"),n.classList.remove("shrink"),n.classList.remove("rotate"),n.classList.remove("refreshing"),n.classList.add("done"),[4,t(0)];case 4:return r.sent(),n.classList.remove("done"),[2]}}))}))}(t))}return e.useEffect((function(){l||function(){var e=document.querySelector("#inbox");if(t.isDesktop){var n=new i.default.Manager(e);n.add(new i.default.Pan({direction:i.default.DIRECTION_VERTICAL,threshold:0})),n.on("panstart",(function(e){return O(e.center.y)})),n.on("pandown",(function(t){return L(t.center.y,e)}))}else e.addEventListener("touchstart",(function(e){return O(e.touches[0].pageY)}),{passive:!0}),e.addEventListener("touchmove",(function(t){return L(t.touches[0].pageY,e)}),{passive:!0})}()}),[l]),l?o.default.createElement("div",s({},g),r):o.default.createElement("div",{className:"refresh-cntr"},o.default.createElement("div",{className:"refresher"},w?o.default.createElement(d,{color:"black"}):o.default.createElement(h,{color:"black"})),o.default.createElement("section",{id:"inbox",className:"refreshList",style:v,onScroll:function(){var e=document.querySelector("#inbox");e.scrollTop+e.clientHeight>=e.scrollHeight&&m()}},r))};exports.InfiniteList=function(t){var n=t.children,r=t.url,i=t.height,l=t.params,a=t.refresh,c=t.headers,u=t.http,f=t.onGetCount,d=t.onApiFailed,h=t.secure,v=void 0===h||h,y=t.authenticated,m=t.loadMoreRef,g=t.onRefresh,b=e.useState(0),w=b[0],x=b[1],E=e.useState(),k=E[0],O=E[1],L=e.useState(!1),S=L[0],j=L[1];function T(){console.log("handleLoadMore"),w&&!S&&(Array.isArray(l)?l.push({page:w}):l=s({page:w},l),j(!0),u.get(r,{params:l,headers:c}).then((function(e){console.log("infinitelist",JSON.stringify(e)),P(null==e?void 0:e.data)})).catch(_))}m&&m((function(){return T()}));var C=e.useCallback((function(e){j(!1),x((null==e?void 0:e.next)?2:0),O(e),f&&f(e.count,e.results)}),[]),P=e.useCallback((function(e){j(!1),x((null==e?void 0:e.next)?w+1:0);var t=(null==k?void 0:k.results)?null==k?void 0:k.results.concat(e.results):e.results;O((function(n){return s(s({},e),{results:t})})),f&&f(e.count,t)}),[w,k]),_=e.useCallback((function(e){j(!1),x(0),d(e)}),[]),R=e.useCallback((function(e,t){S?t&&t():(x(0),j(!0),g&&g(),u.get(r,{params:l,headers:c}).then((function(t){console.log("infinitelist",t),C(null==t?void 0:t.data),e&&e()})).catch((function(e){console.log("infinitelist error",JSON.stringify(e)),_(e),t&&t()})))}),[_,C,l,S,r]);return e.useEffect((function(){!y&&v||R()}),[r,a,y]),i?o.default.createElement(p,{className:"pull-refresh-container",style:{height:i},onRefresh:R,loading:S,distanceToRefresh:30,onScrollEnd:T},n(null==k?void 0:k.count,null==k?void 0:k.results)):n(null==k?void 0:k.count,null==k?void 0:k.results)};
//# sourceMappingURL=index.js.map
