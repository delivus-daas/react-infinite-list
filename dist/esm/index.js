import e,{Component as t,useState as n,useCallback as r,useEffect as o}from"react";import{isDesktop as i}from"react-device-detect";import s from"hammerjs";var c=function(e,t){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},c(e,t)};var l=function(){return l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},l.apply(this,arguments)};function a(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function u(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function c(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}l((r=r.apply(e,t||[])).next())}))}function f(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}var h={transition:"opacity 0.3s"},p=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.highlighted=0,e.circles=[6,20,34],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(n,t),n.prototype.componentDidMount=function(){var e=this,t=this.circles.length;this.intervalId=setInterval((function(){var n=e.highlighted+1;e.highlighted=n>=t?0:n,e.forceUpdate()}),300)},n.prototype.shouldComponentUpdate=function(){return!1},n.prototype.componentWillUnmount=function(){clearInterval(this.intervalId)},n.prototype.render=function(){var t=this,n=t.props.color,r=t.highlighted,o=t.circles;return e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40",width:"32px",height:"32px"},o.map((function(t,o){return e.createElement("circle",{key:o,cx:t,cy:"20",r:"3",fill:n,opacity:r===o?1:.2,style:h})})))},n}(t);function d(t){var n=t.color,r=a(t,["color"]);return e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40",width:"32px",height:"32px"},r),e.createElement("line",{x1:"20",y1:"4",x2:"20",y2:"32",strokeLinecap:"round",strokeWidth:3,stroke:n}),e.createElement("polyline",{points:"10 24 20 34 30 24",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,fill:"none",stroke:n}))}var v=function(t){var c=t.children;t.className;var h=t.disabled,v=t.distanceToRefresh,y=void 0===v?30:v,m=t.style,g=t.onRefresh,w=t.onScrollEnd,b=a(t,["children","className","disabled","distanceToRefresh","style","onRefresh","onScrollEnd"]),x=n(!1),E=x[0],O=x[1],L=0,k=r((function(){return new Promise((function(e,t){g(e,t)}))}),[]);function S(e){L=e}function T(e,t){0===document.scrollingElement.scrollTop&&0===t.scrollTop&&e>L&&(e-L<y&&(t.style.transform=t.style.webkitTransform="translate3d( 0, "+e+"px, 0 )"),t.classList.contains("refreshing")||function(e){u(this,void 0,void 0,(function(){var t,n;return f(this,(function(r){switch(r.label){case 0:return t=function(e){return new Promise((function(t){return setTimeout(t,e)}))},O(!0),k(),n=document.querySelector(".refresher"),e.classList.add("refreshing"),n.classList.add("refreshing"),[4,t(500)];case 1:return r.sent(),O(!1),n.classList.add("rotate"),[4,t(500)];case 2:return r.sent(),e.style.transform=e.style.webkitTransform="",n.classList.add("shrink"),[4,t(500)];case 3:return r.sent(),e.classList.remove("refreshing"),n.classList.remove("shrink"),n.classList.remove("rotate"),n.classList.remove("refreshing"),n.classList.add("done"),[4,t(0)];case 4:return r.sent(),n.classList.remove("done"),[2]}}))}))}(t))}return o((function(){h||function(){var e=document.querySelector("#inbox");if(i){var t=new s.Manager(e);t.add(new s.Pan({direction:s.DIRECTION_VERTICAL,threshold:0})),t.on("panstart",(function(e){return S(e.center.y)})),t.on("pandown",(function(t){return T(t.center.y,e)}))}else e.addEventListener("touchstart",(function(e){return S(e.touches[0].pageY)}),{passive:!0}),e.addEventListener("touchmove",(function(t){return T(t.touches[0].pageY,e)}),{passive:!0})}()}),[h]),h?e.createElement("div",l({},b),c):e.createElement("div",{className:"refresh-cntr"},e.createElement("div",{className:"refresher"},E?e.createElement(p,{color:"black"}):e.createElement(d,{color:"black"})),e.createElement("section",{id:"inbox",className:"refreshList",style:m,onScroll:function(){var e=document.querySelector("#inbox");e.scrollTop+e.clientHeight>=e.scrollHeight&&w()}},c))},y=function(t){var i=t.children,s=t.url,c=t.height,a=t.params,u=t.refresh,f=t.headers,h=t.http,p=t.onGetCount,d=t.onApiFailed,y=t.secure,m=void 0===y||y,g=t.authenticated,w=t.loadMoreRef,b=t.onRefresh,x=n(0),E=x[0],O=x[1],L=n(),k=L[0],S=L[1],T=n(!1),j=T[0],P=T[1];function R(){console.log("handleLoadMore"),E&&!j&&(Array.isArray(a)?a.push({page:E}):a=l({page:E},a),P(!0),h.get(s,{params:a,headers:f}).then((function(e){console.log("infinitelist",JSON.stringify(e)),_(null==e?void 0:e.data)})).catch(I))}w&&w((function(){return R()}));var N=r((function(e){P(!1),O((null==e?void 0:e.next)?2:0),S(e),p&&p(e.count,e.results)}),[]),_=r((function(e){P(!1),O((null==e?void 0:e.next)?E+1:0);var t=(null==k?void 0:k.results)?null==k?void 0:k.results.concat(e.results):e.results;S((function(n){return l(l({},e),{results:t})})),p&&p(e.count,t)}),[E,k]),I=r((function(e){P(!1),O(0),d(e)}),[]),A=r((function(e,t){j?t&&t():(O(0),P(!0),b&&b(),h.get(s,{params:a,headers:f}).then((function(t){console.log("infinitelist",t),N(null==t?void 0:t.data),e&&e()})).catch((function(e){console.log("infinitelist error",JSON.stringify(e)),I(e),t&&t()})))}),[I,N,a,j,s]);return o((function(){!g&&m||A()}),[s,u,g]),c?e.createElement(v,{className:"pull-refresh-container",style:{height:c},onRefresh:A,loading:j,distanceToRefresh:30,onScrollEnd:R},i(null==k?void 0:k.count,null==k?void 0:k.results)):i(null==k?void 0:k.count,null==k?void 0:k.results)};export{y as InfiniteList};
//# sourceMappingURL=index.js.map
