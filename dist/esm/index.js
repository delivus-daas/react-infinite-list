import e,{Component as t,useState as n,useCallback as r,useEffect as o,useRef as i}from"react";import{isDesktop as c}from"react-device-detect";import s from"hammerjs";var l=function(e,t){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},l(e,t)};var a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},a.apply(this,arguments)};function u(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function f(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}l((r=r.apply(e,t||[])).next())}))}function h(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var p={transition:"opacity 0.3s"},d=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.highlighted=0,e.circles=[6,20,34],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(n,t),n.prototype.componentDidMount=function(){var e=this,t=this.circles.length;this.intervalId=setInterval((function(){var n=e.highlighted+1;e.highlighted=n>=t?0:n,e.forceUpdate()}),300)},n.prototype.shouldComponentUpdate=function(){return!1},n.prototype.componentWillUnmount=function(){clearInterval(this.intervalId)},n.prototype.render=function(){var t=this,n=t.props.color,r=t.highlighted,o=t.circles;return e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40",width:"32px",height:"32px"},o.map((function(t,o){return e.createElement("circle",{key:o,cx:t,cy:"20",r:"3",fill:n,opacity:r===o?1:.2,style:p})})))},n}(t);function v(t){var n=t.color,r=u(t,["color"]);return e.createElement("svg",a({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40",width:"32px",height:"32px"},r),e.createElement("line",{x1:"20",y1:"4",x2:"20",y2:"32",strokeLinecap:"round",strokeWidth:3,stroke:n}),e.createElement("polyline",{points:"10 24 20 34 30 24",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,fill:"none",stroke:n}))}var y=function(t){var i=t.children;t.className;var l=t.disabled,p=t.distanceToRefresh,y=void 0===p?30:p,m=t.style,g=t.onRefresh,w=t.onScrollEnd,b=u(t,["children","className","disabled","distanceToRefresh","style","onRefresh","onScrollEnd"]),x=n(!1),E=x[0],O=x[1],L=0,k=r((function(){return new Promise((function(e,t){g(e,t)}))}),[]);function S(e){L=e}function T(e,t){0===document.scrollingElement.scrollTop&&0===t.scrollTop&&e>L&&(e-L<y&&(t.style.transform=t.style.webkitTransform="translate3d( 0, "+e+"px, 0 )"),t.classList.contains("refreshing")||function(e){f(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return t=function(e){return new Promise((function(t){return setTimeout(t,e)}))},O(!0),k(),n=document.querySelector(".refresher"),e.classList.add("refreshing"),n.classList.add("refreshing"),[4,t(500)];case 1:return r.sent(),O(!1),n.classList.add("rotate"),[4,t(500)];case 2:return r.sent(),e.style.transform=e.style.webkitTransform="",n.classList.add("shrink"),[4,t(500)];case 3:return r.sent(),e.classList.remove("refreshing"),n.classList.remove("shrink"),n.classList.remove("rotate"),n.classList.remove("refreshing"),n.classList.add("done"),[4,t(0)];case 4:return r.sent(),n.classList.remove("done"),[2]}}))}))}(t))}return o((function(){l||function(){var e=document.querySelector("#inbox");if(c){var t=new s.Manager(e);t.add(new s.Pan({direction:s.DIRECTION_VERTICAL,threshold:0})),t.on("panstart",(function(e){return S(e.center.y)})),t.on("pandown",(function(t){return T(t.center.y,e)}))}else e.addEventListener("touchstart",(function(e){return S(e.touches[0].pageY)}),{passive:!0}),e.addEventListener("touchmove",(function(t){return T(t.touches[0].pageY,e)}),{passive:!0})}()}),[l]),l?e.createElement("div",a({},b),i):e.createElement("div",{className:"refresh-cntr"},e.createElement("div",{className:"refresher"},E?e.createElement(d,{color:"black"}):e.createElement(v,{color:"black"})),e.createElement("section",{id:"inbox",className:"refreshList",style:m,onScroll:function(){var e=document.querySelector("#inbox");e.scrollTop+e.clientHeight>=e.scrollHeight&&w()}},i))},m=function(t){var c=t.children,s=t.url,l=t.height,u=t.params,f=t.refresh,h=t.headers,p=t.http,d=t.onGetCount,v=t.onApiFailed,m=t.secure,g=void 0===m||m,w=t.authenticated,b=t.loadMoreRef,x=t.onRefresh,E=i(1),O=n(),L=O[0],k=O[1],S=n(!1),T=S[0],j=S[1];function P(){console.log("handleLoadMore ",E.current,T),1==E.current||T||(Array.isArray(u)?u.push({page:E.current}):u=a({page:E.current},u),j(!0),p.get(s,{params:u,headers:h}).then((function(e){console.log("infinitelist",JSON.stringify(e)),N(null==e?void 0:e.data)})).catch(_))}b&&b((function(){return P()}));var R=r((function(e){j(!1),E.current=(null==e?void 0:e.next)?2:1,k(e),d&&d(e.count,e.results)}),[]),N=r((function(e){j(!1),E.current=(null==e?void 0:e.next)?E.current+1:1;var t=(null==L?void 0:L.results)?null==L?void 0:L.results.concat(e.results):e.results;k((function(n){return a(a({},e),{results:t})})),d&&d(e.count,t)}),[L]),_=r((function(e){j(!1),E.current=1,v(e)}),[]),I=r((function(e,t){T?t&&t():(E.current=1,j(!0),x&&x(),p.get(s,{params:u,headers:h}).then((function(t){console.log("infinitelist",t),R(null==t?void 0:t.data),e&&e()})).catch((function(e){console.log("infinitelist error",JSON.stringify(e)),_(e),t&&t()})))}),[_,R,u,T,s]);return o((function(){!w&&g||I()}),[s,f,w]),l?e.createElement(y,{className:"pull-refresh-container",style:{height:l},onRefresh:I,loading:T,distanceToRefresh:30,onScrollEnd:P},c(null==L?void 0:L.count,null==L?void 0:L.results)):c(null==L?void 0:L.count,null==L?void 0:L.results)};export{m as InfiniteList};
//# sourceMappingURL=index.js.map
